<template>

    
    <lightning-card title="Upload Contact Profile Images">
        <div class="slds-page-header">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <span class="slds-icon_container slds-icon-standard-opportunity" title="opportunity">
                                <svg class="slds-icon slds-page-header__icon" aria-hidden="true">
                                    <use xlink:href="/_slds/icons/standard-sprite/svg/symbols.svg#opportunity"></use>
                                </svg>
                                <span class="slds-assistive-text">Student Profiles</span>
                            </span>
                        </div>
                        <div class="slds-media__body">
                            <div class="slds-page-header__name">
                                <div class="slds-page-header__name-title">
                                    <h1>
                                    <span class="slds-page-header__title slds-truncate" title="Bulk Profile Image Upload">Bulk Profile Image Upload</span>
                                    </h1>
                                </div>
                            </div>
                            <lightning-button variant="brand" label="Submit All" onclick={submitAll} title="Submit All" class="slds-m-left_x-small slds-float_right" slot="actions"></lightning-button>
                            <lightning-button variant="natural" label="Back" onclick={backPage} title="Back" class="slds-m-left_x-small slds-float_right" slot="actions"></lightning-button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
            <table class="slds-table slds-table_bordered slds-table_striped 
            slds-table_fixed-layout records-table" style="border: 1px solid rgb(217, 219, 221);">
                    <thead>
                        <tr class="slds-text-title_caps">
                            <th class="" scope="col">
                                <div class="slds-truncate" title="CVUE Student Number">CVUE Student Number</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Name">Name</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Student Batch">Student Batch</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Blood Group">Blood Group</div>
                            </th>
                            <th class="" scope="col">
                                <div class="slds-truncate" title="Upload Image">Upload Image</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={contactList} for:item="con" for:index="index">
                            <tr key={con.Id} >
                                <th scope="col">
                                    {con.CVUE_Student_Number__c}
                                </th>
                                <th scope="col">
                                    {con.Name}
                                </th>
                                <th scope="col">
                                    {con.Student_Batch__c}
                                </th>
                                <th scope="col">
                                    {con.Blood_Group__c}
                                </th>
                                <th scope="col">
                                    <lightning-input
                                        type="file"
                                        data-id={con.Name}
                                        data-index={index}
                                        data-totalids={contactList.length}
                                        data-studentid={con.CVUE_Student_Number__c}
                                        label=""
                                        name={con.Id}
                                        accept="image/png, .jpeg, .jpg"
                                        onchange={handleFilesChange}>
                                    </lightning-input>
                                    <img class="imgToResize"  data-id={con.Id} />
                                    <img class="resizedImage" data-idd={con.Id} />
                                    <lightning-spinner data-index={index} data-id={con.Id} alternative-text="Loading" size="small" style="display:none"></lightning-spinner>
                                    <h5 data-index={index} id={con.CVUE_Student_Number__c} data-id={con.Id} class="slds-theme_success" style="display:none;text-align:center">File Uploaded Successfully!</h5>
                                    <h4 data-index={index} id={con.CVUE_Student_Number__c} data-id={con.Id} class="slds-theme_error" style="display:none;font-size: 1em;font-weight: inherit;text-align:center">File size should be less than 9MB.</h4>
                                    <h3 data-index={index} id={con.CVUE_Student_Number__c} data-id={con.Id} class="slds-theme_error" style="display:none;font-size: 1em;font-weight: inherit;text-align:center">Something went wrong! Please try again.</h3>
                                    
                                </th>
                            </tr>
                        </template>
                    </tbody>
                    
            </table>

            <template if:true={showLoadingSpinner}>
                <lightning-spinner alternative-text="Uploading......" size="medium"></lightning-spinner>
            </template>

            <template if:true={error}>
                {error.body}
            </template>
        
    </lightning-card>
</template>